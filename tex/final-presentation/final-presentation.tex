% !TEX TS-program = xelatex
%
\documentclass[aspectratio=1610]{beamer}

\input{../common.tex}

\newcolumntype{R}{>{\raggedleft\arraybackslash}X}
\newcolumntype{C}{>{\centering\arraybackslash}X}

\newcommand\green[1]{{\color{green(ncs)}#1}}
\newcommand\red[1]{{\color{amaranth}#1}}

\begin{document}
  \maketitle

  \begin{frame}{Outline}
    \begin{itemize}
      \item Introduction
      \item What is the Internet of things?
      \item What is serverless computing?
      \item Devices
      \item Background
      \item Implementation
      \item Results
      \item Schedule
    \end{itemize}
  \end{frame}

  \begin{frame}{Introduction}
    \begin{itemize}
      \item collect data from various devices
      \item devices post data to broker
      \item serverless function called depending on data type
      \item data saved in database
      \item web application to visualize data and statistics
    \end{itemize}
  \end{frame}

  \begin{frame}{What is the Internet of things (IoT)?}
    \begin{itemize}
      \item everyday objects (things) connected to the Internet
      \item collection of switches and sensors
      \item controlled or monitored remotely via the Internet or by other IoT devices
    \end{itemize}
  \end{frame}

  \begin{frame}{What is serverless computing?}
    \begin{itemize}
      \item confusing name, actually still requires servers
      \item cloud provider runs master server
      \item master server manages scaling and allocates resources
      \item functions deployed on-demand
    \end{itemize}
  \end{frame}

  \begin{frame}{Devices -- Smartphone}
    \begin{itemize}
      \item gyroscope
            \hspace*{2em}
            \includegraphics[align=c,height=3em]{bmi160-sensor}
      \item accelerometer
      \item magnetometer
      \item barometer
            \hspace*{2em}
            \includegraphics[align=c,height=3em]{barometric-sensor}
      \item gravity
      \item temperature
      \item humidity
            \hspace*{2em}
            \includegraphics[align=c,height=3em]{shtc3-humidity-sensor}
      \item possibly GPS location
    \end{itemize}
  \end{frame}

  \begin{frame}{Devices -- Raspberry Pi}
    \begin{itemize}
      \item temperature sensor
            \hspace*{2em}
            \includegraphics[align=c,height=5em]{dht11-sensor}
      \item humidity sensor
      \item magnetic hall sensor
            \hspace*{2em}
            \includegraphics[align=c,height=4em]{hall-sensor}
      \item light intensity sensor
            \hspace*{2em}
            \includegraphics[align=c,height=2em]{light-sensor}
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Overview}
    \begin{itemize}
      \item written entirely in Rust
      \item cross-compiled for ARMv7
      \item collects data from 8 sensors
      \item posts sensor data as \textit{JSON} to \textit{Kafka REST}
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Rust}
    \begin{itemize}
      \item native code, no interpreter overhead
      \item low latency for sensor measurements
      \item efficient processing of sensor data
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Sensors}
    \begin{tabularx}{\textwidth}{XC}
      \begin{itemize}
        \item built-in
          \begin{itemize}
            \item memory usage
            \item CPU load
            \item CPU temperature
          \end{itemize}
      \end{itemize}
      &
      \includegraphics[valign=t,width=5em]{rpi-cpu}
      \\
      \begin{itemize}
        \item ADS1115 with photoresistor
          \begin{itemize}
            \item luminosity
          \end{itemize}
      \end{itemize}
      &
      \includegraphics[valign=t,width=5em]{light-sensor}
    \end{tabularx}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Sensors}
    \begin{tabularx}{\textwidth}{XC}
      \begin{itemize}
        \item BMP180
          \begin{itemize}
            \item air pressure
            \item air temperature
          \end{itemize}
      \end{itemize}
      &
      \includegraphics[valign=t,width=5em]{barometric-sensor}
      \\
      \begin{itemize}
        \item AM2320
          \begin{itemize}
            \item air humidity
            \item air temperature
          \end{itemize}
      \end{itemize}
      &
      \includegraphics[valign=t,width=5em]{am2320}
    \end{tabularx}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \begin{itemize}
      \item “Hello, world!”
      \item code synchronised to Raspberry Pi
      \item compiled directly on Raspberry Pi
      \item \green{pro:} simple
      \item \red{con:} slow
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \begin{itemize}
      \item more sensors, more dependencies
      \item compile time approached 30 minutes for a fresh build
      \item compile time approached 5 minutes for a single iteration
      \item \green{solution:} cross-compilation
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \begin{itemize}
      \item \texttt{cross} tool (\url{https://github.com/rust-embedded/cross})
      \item uses Docker to compile for different targets
      \item \green{pro:} “zero setup cross-compilation”
      \item \green{pro:} wrapper for \texttt{cargo}
      \item \green{pro:} arbitrary Rust version
      \item \red{con:} no macOS or Windows support
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \includegraphics[valign=c,height=5em]{macos-logo}
    \hspace*{1em}
    \&
    \hspace*{1em}
    \includegraphics[valign=c,height=5em]{windows-logo}

    \vspace*{1.5em}

    \begin{itemize}
      \item \green{solution:} implement macOS and Windows support for the \texttt{cross} tool
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \begin{itemize}
      \item check host target
        \begin{itemize}
          \item if supported, run \texttt{cargo} inside Docker container
            \begin{itemize}
              \item install needed toolchain (e.g. \texttt{armv7-unknown-linux-gnueabi}) using \texttt{rustup}
              \item mount toolchain into container
              \item mount cargo index into container
              \item run \texttt{cargo} inside container
            \end{itemize}
          \item else, fall back to running \texttt{cargo} locally
        \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}{Raspberry Pi Application -- Implementation}
    \begin{itemize}
      \item add macOS and Windows target triples to supported hosts
      \item \green{success:} Docker is actually invoked on macOS and on Windows
      \item \red{problem:} compilation on macOS still not working
         \begin{itemize}
           \item Docker container (Linux) tries to execute macOS binary
           \item \green{solution:} override mounted binary directory with empty directory
         \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- Docker}
    \includegraphics[height=5em]{docker-logo}

    \vspace*{1.5em}

    \begin{itemize}
      \item software packaged into containers
      \item Docker containers are standardised
      \item lightweight compared to Virtual Machines
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- Docker}
    \vfill
    \includegraphics[width=\textwidth]{docker-containerized-and-vm}
  \end{frame}

  \begin{frame}{Background -- Rust}
    \includegraphics[height=6em]{rust-logo}

    \vspace*{1.5em}

    \begin{itemize}
      \item safe and race-condition free
      \item concurrent
      \item performant
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- OpenFaaS}
    \includegraphics[width=\textwidth]{openfaas-stack}
  \end{frame}

  \begin{frame}{Background -- Kafka / Zookeeper}
    \includegraphics[height=6em]{kafka-logo}

    \vspace*{1.5em}

    \begin{itemize}
      \item devices post data to broker
      \item triggers serverless functions
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- MongoDB}
    \includegraphics[height=5em]{mongodb-logo}

    \vspace*{1.5em}

    \begin{itemize}
      \item persistence layer for sensor data
      \item versatile due to its JavaScript origin
      \item JSON-like documents
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- Flutter}
    \includegraphics[height=4.5em]{flutter-logo}

    \vspace*{2em}

    \begin{itemize}
      \item cross platform UI framework from Google
      \item Dart
      \item compiles to platform native code
    \end{itemize}
  \end{frame}

  \begin{frame}{Background -- MarkoJS}
    \includegraphics[height=6em]{marko-logo}

    \vspace*{2em}

    \begin{itemize}
      \item Open Source client-side web framework from ebay
      \item similar to React
      \item support for concise syntax
    \end{itemize}
  \end{frame}

  \begin{frame}[fragile]{Implementation -- MongoDB}
    \begin{columns}
      \column{0.4\textwidth}
        \begin{itemize}
          \item issues
          \item architecture of \texttt{sensordata} database
            \begin{itemize}
              \item collection per sensor type
              \item differ depending on amount of returned values
            \end{itemize}
          \item devices have to be registered
        \end{itemize}
        \column{0.6\textwidth}
          \begin{lstlisting}[language=mongo, basicstyle=\scriptsize\ttfamily]
          {
            _id: 'c7704c421d7491ec',
            name: 'Samsung Galaxy S7',
            data_types: [
                'cpu_frequency',
                'proximity',
                'acceleration',
                'rotation',
                'pressure',
                'orientation',
                'gravity',
                'illuminance',
                'rotation_rate',
                'rotation_rate_uncalibrated',
                'magnetic_field',
                'magnetic_field_uncalibrated'
            ]
          }
          \end{lstlisting}
     \end{columns}
  \end{frame}

  \begin{frame}{Implementation -- Mobile Application}
    \begin{itemize}
      \item basic workflow
      \item difficulties with platform specific requirements
      \item fist try with React Native
      \item final Implementation in Flutter
      \item consists of five Views
    \end{itemize}
  \end{frame}

  \begin{frame}{Implementation -- Serverless Stack}
    \begin{itemize}
      \item central part of the technology stack
      \item manages serverless functions
      \item first class Docker support
      \item configurable with a YAML file
      \item deployable with a single RAKE task
    \end{itemize}
  \end{frame}

  \begin{frame}{Implementation -- UI}
    \begin{itemize}
      \item implemented in MarkoJS
      \item Babel
      \item Webpack
      \item SASS
    \end{itemize}
  \end{frame}

  \begin{frame}{Schedule}
    \begin{itemize}
      \item March
        \begin{itemize}
          \item setup serverless stack
          \item start mobile application
        \end{itemize}
      \item April
        \begin{itemize}
          \item finish mobile application
          \item start Raspberry Pi application
          \item start web application
        \end{itemize}
      \item May
        \begin{itemize}
          \item finish Raspberry Pi application
          \item finish web application
          \item start written part
        \end{itemize}
      \item June
        \begin{itemize}
          \item finalize bachelor’s thesis
        \end{itemize}
    \end{itemize}
  \end{frame}
\end{document}
